
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Go AST Scanner</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.2.1/css/bulma.min.css" integrity="sha256-DRcOKg8NK1KkSkcymcGmxOtS/lAn0lHWJXRa15gMHHk=" crossorigin="anonymous"/>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.min.js" integrity="sha256-cLWs9L+cjZg8CjGHMpJqUgKKouPlmoMP/0wIdPtaPGs=" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react-dom.min.js" integrity="sha256-JIW8lNqN2EtqC6ggNZYnAdKMJXRQfkPMvdRt+b0/Jxc=" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.17.0/babel.min.js" integrity="sha256-1IWWLlCKFGFj/cjryvC7GDF5wRYnf9tSvNVVEj8Bm+o=" crossorigin="anonymous"></script>
  <style>
    div.issue div.tag, div.panel-block input[type="checkbox"] {
      margin-right: 0.5em;
    }
    
    label.disabled {
      text-decoration: line-through;
    }
    
    nav.panel select {
      width: 100%;
    }

    .break-word {
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <section class="section">
    <div class="container">
      <div id="content"></div>
    </div>
  </section>
  <script>
    var data = {"Golang errors":{"/Users/whale4u/Code/GoProject/web/BlueBird.go":[{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"},{"line":66,"column":6,"error":"other declaration of main"}],"/Users/whale4u/Code/GoProject/web/gin_hello.go":[{"line":7,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/gin_receive_json.go":[{"line":15,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/gin_resp_json.go":[{"line":8,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/gin_restful.go":[{"line":7,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/hello_web.go":[{"line":12,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/login.go":[{"line":43,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/md5_demo.go":[{"line":9,"column":6,"error":"main redeclared in this block"},{"line":11,"column":17,"error":"undeclared name: str"}],"/Users/whale4u/Code/GoProject/web/post_formvalue_demo.go":[{"line":8,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/rc4_demo.go":[{"line":11,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/restful.go":[{"line":42,"column":6,"error":"main redeclared in this block"}],"/Users/whale4u/Code/GoProject/web/upload.go":[{"line":56,"column":6,"error":"main redeclared in this block"}]},"Issues":[{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"326","URL":"https://cwe.mitre.org/data/definitions/326.html"},"rule_id":"G401","details":"Use of weak cryptographic primitive","file":"/Users/whale4u/Code/GoProject/web/rc4_demo.go","code":"29: \t\tdest2 := make([]byte, len(dest1))\n30: \t\tcipher2, _ := rc4.NewCipher(key) // 切记：这里不能重用cipher1，必须重新生成新的\n31: \t\tcipher2.XORKeyStream(dest2, dest1)\n","line":"30","column":"17"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"326","URL":"https://cwe.mitre.org/data/definitions/326.html"},"rule_id":"G401","details":"Use of weak cryptographic primitive","file":"/Users/whale4u/Code/GoProject/web/rc4_demo.go","code":"22: \t\tfmt.Printf(\"方法1加密前:%s \\n\", str)\n23: \t\tcipher1, _ := rc4.NewCipher(key)\n24: \t\tcipher1.XORKeyStream(dest1, str)\n","line":"23","column":"17"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"326","URL":"https://cwe.mitre.org/data/definitions/326.html"},"rule_id":"G401","details":"Use of weak cryptographic primitive","file":"/Users/whale4u/Code/GoProject/web/md5_demo.go","code":"9: func main() {\n10: \th := md5.New()\n11: \th.Write([]byte(str))\n","line":"10","column":"7"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"22","URL":"https://cwe.mitre.org/data/definitions/22.html"},"rule_id":"G304","details":"Potential file inclusion via variable","file":"/Users/whale4u/Code/GoProject/web/upload.go","code":"24: \t// 打开文件句柄操作\n25: \tfh, err := os.Open(filename)\n26: \tif err != nil {\n","line":"25","column":"13"},{"severity":"MEDIUM","confidence":"MEDIUM","cwe":{"ID":"88","URL":"https://cwe.mitre.org/data/definitions/88.html"},"rule_id":"G107","details":"Potential HTTP request made with variable url","file":"/Users/whale4u/Code/GoProject/web/upload.go","code":"40: \n41: \tresp, err := http.Post(targetUrl, contentType, bodyBuf)\n42: \tif err != nil {\n","line":"41","column":"15"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G307","details":"Deferring unsafe method \"Close\" on type \"*os.File\"","file":"/Users/whale4u/Code/GoProject/web/upload.go","code":"29: \t}\n30: \tdefer fh.Close()\n31: \n","line":"30","column":"2"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"327","URL":"https://cwe.mitre.org/data/definitions/327.html"},"rule_id":"G503","details":"Blocklisted import crypto/rc4: weak cryptographic primitive","file":"/Users/whale4u/Code/GoProject/web/rc4_demo.go","code":"3: import (\n4: \t\"crypto/rc4\"\n5: \t\"fmt\"\n","line":"4","column":"2"},{"severity":"MEDIUM","confidence":"HIGH","cwe":{"ID":"327","URL":"https://cwe.mitre.org/data/definitions/327.html"},"rule_id":"G501","details":"Blocklisted import crypto/md5: weak cryptographic primitive","file":"/Users/whale4u/Code/GoProject/web/md5_demo.go","code":"3: import (\n4: \t\"crypto/md5\"\n5: \t\"encoding/hex\"\n","line":"4","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/upload.go","code":"58: \tfilename := \"/Users/whale4u/Code/GoProject/advanced/hammer.jpeg\"\n59: \tpostFile(filename, target_url)\n60: }\n","line":"59","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/upload.go","code":"38: \tcontentType := bodyWriter.FormDataContentType()\n39: \tbodyWriter.Close()\n40: \n","line":"39","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/md5_demo.go","code":"10: \th := md5.New()\n11: \th.Write([]byte(str))\n12: \tfmt.Println(hex.EncodeToString(h.Sum(nil)))\n","line":"11","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/login.go","code":"11: func sayhelloName(w http.ResponseWriter, r *http.Request) {\n12: \tr.ParseForm() // 解析 url 传递的参数，对于 POST 则解析响应包的主体（request body）\n13: \t// 注意:如果没有调用 ParseForm 方法，下面无法获取表单的数据\n","line":"12","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/hello_web.go","code":"13: \thttp.HandleFunc(\"/\", handler)\n14: \thttp.ListenAndServe(\":8080\", nil)\n15: }\n","line":"14","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/gin_restful.go","code":"32: \n33: \tr.Run()\n34: }\n","line":"33","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/gin_resp_json.go","code":"27: \t})\n28: \tr.Run(\":8080\")\n29: }\n","line":"28","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/gin_receive_json.go","code":"36: \t})\n37: \tr.Run(\":8080\")\n38: }\n","line":"37","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/gin_hello.go","code":"18: \t// 启动HTTP服务，默认在0.0.0.0:8080启动服务\n19: \tr.Run()\n20: }\n","line":"19","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/BlueBird.go","code":"97: \t})\n98: \tr.Run(\":8080\")\n99: }\n","line":"98","column":"2"},{"severity":"LOW","confidence":"HIGH","cwe":{"ID":"703","URL":"https://cwe.mitre.org/data/definitions/703.html"},"rule_id":"G104","details":"Errors unhandled.","file":"/Users/whale4u/Code/GoProject/web/BlueBird.go","code":"67: \n68: \tinitDB()\n69: \n","line":"68","column":"2"}],"Stats":{"files":12,"lines":470,"nosec":0,"found":19}};
  </script>
  <script type="text/babel">
    var IssueTag = React.createClass({
      render: function() {
        var level = ""
        if (this.props.level === "HIGH") {
          level = "is-danger";
        }
        if (this.props.level === "MEDIUM") {
          level = "is-warning";
        }
        return (
          <div className="tag { level }">
            { this.props.label }: { this.props.level }
          </div>
        );
      }
    });
    
    var Issue = React.createClass({
      render: function() {
        return (
          <div className="issue box">
            <div className="is-pulled-right">
              <IssueTag label="Severity" level={ this.props.data.severity }/>
              <IssueTag label="Confidence" level={ this.props.data.confidence }/>
            </div>
            <p>
              <strong className="break-word">
                { this.props.data.file } (line { this.props.data.line })
              </strong>
              <br/>
              { this.props.data.details }
            </p>
            <figure className="highlight">
              <pre>
                <code className="golang hljs">
                  { this.props.data.code }
                </code>
              </pre>
            </figure>
          </div>
        );
      }
    });
    
    var Stats = React.createClass({
      render: function() {
        return (
          <p className="help">
            Scanned { this.props.data.Stats.files.toLocaleString() } files
            with { this.props.data.Stats.lines.toLocaleString() } lines of code.
          </p>
        );
      }
    });
    
    var Issues = React.createClass({
      render: function() {
        if (this.props.data.Stats.files === 0) {
          return (
            <div className="notification">
              No source files found. Do you even Go?
            </div>
          );
        }
    
        if (this.props.data.Issues.length === 0) {
          return (
            <div>
              <div className="notification">
                Awesome! No issues found!
              </div>
              <Stats data={ this.props.data } />
            </div>
          );
        }
    
        var issues = this.props.data.Issues
          .filter(function(issue) {
            return this.props.severity.includes(issue.severity);
          }.bind(this))
          .filter(function(issue) {
            return this.props.confidence.includes(issue.confidence);
          }.bind(this))
          .filter(function(issue) {
            if (this.props.issueType) {
              return issue.details.toLowerCase().startsWith(this.props.issueType.toLowerCase());
            } else {
              return true
            }
          }.bind(this))
          .map(function(issue) {
            return (<Issue data={issue} />);
          }.bind(this));
    
        if (issues.length === 0) {
          return (
            <div>
              <div className="notification">
                No issues matched given filters
                (of total { this.props.data.Issues.length } issues).
              </div>
              <Stats data={ this.props.data } />
            </div>
          );
        }
    
        return (
          <div className="issues">
            { issues }
            <Stats data={ this.props.data } />
          </div>
        );
      }
    });
    
    var LevelSelector = React.createClass({
      handleChange: function(level) {
        return function(e) {
          var updated = this.props.selected
            .filter(function(item) { return item != level; });
          if (e.target.checked) {
            updated.push(level);
          }
          this.props.onChange(updated);
        }.bind(this);
      },
      render: function() {
        var highDisabled = !this.props.available.includes("HIGH");
        var mediumDisabled = !this.props.available.includes("MEDIUM");
        var lowDisabled = !this.props.available.includes("LOW");
        var on = "", off = "disabled";
        var HIGH = "HIGH", MEDIUM = "MEDIUM", LOW = "LOW";
        return (
          <span>
            <label className="label checkbox { (highDisabled ? off : on )}">
              <input
                type="checkbox"
                checked={ this.props.selected.includes(HIGH) }
                disabled={ highDisabled }
                onChange={ this.handleChange(HIGH) }/>
              High
            </label>
            <label className="label checkbox {( mediumDisabled ? off : on )}">
              <input
                type="checkbox"
                checked={ this.props.selected.includes(MEDIUM) }
                disabled={ mediumDisabled }
                onChange={ this.handleChange(MEDIUM) }/>
              Medium
            </label>
            <label className="label checkbox {( lowDisabled ? off : on )}">
              <input
                type="checkbox"
                checked={ this.props.selected.includes(LOW) }
                disabled={ lowDisabled }
                onChange={ this.handleChange(LOW) }/>
              Low
            </label>
          </span>
        );
      }
    });
    
    var Navigation = React.createClass({
      updateSeverity: function(vals) {
        this.props.onSeverity(vals);
      },
      updateConfidence: function(vals) {
        this.props.onConfidence(vals);
      },
      updateIssueType: function(e) {
        if (e.target.value == "all") {
          this.props.onIssueType(null);
        } else {
          this.props.onIssueType(e.target.value);
        }
      },
      render: function() {
        var issueTypes = this.props.allIssueTypes
          .map(function(it) {
            var matches = this.props.issueType == it
            return (
              <option value={ it } selected={ matches }>
                { it }
              </option>
            );
          }.bind(this));
        return (
          <nav className="panel">
            <div className="panel-heading">
              Filters
            </div>
            <div className="panel-block">
              <strong>
                Severity
              </strong>
            </div>
            <div className="panel-block">
              <LevelSelector 
                selected={ this.props.severity }
                available={ this.props.allSeverities }
                onChange={ this.updateSeverity } />
            </div>
            <div className="panel-block">
              <strong>
                Confidence
              </strong>
            </div>
            <div className="panel-block">
              <LevelSelector
                selected={ this.props.confidence }
                available={ this.props.allConfidences }
                onChange={ this.updateConfidence } />
            </div>
            <div className="panel-block">
              <strong>
                Issue Type
              </strong>
            </div>
            <div className="panel-block">
              <select onChange={ this.updateIssueType }>
                <option value="all" selected={ !this.props.issueType }>
                  (all)
                </option>
                { issueTypes }
              </select>
            </div>
          </nav>
        );
      }
    });
    var IssueBrowser = React.createClass({
      getInitialState: function() {
        return {};
      },
      componentWillMount: function() {
        this.updateIssues(this.props.data);
      },
      handleSeverity: function(val) {
        this.updateIssueTypes(this.props.data.Issues, val, this.state.confidence);
        this.setState({severity: val});
      },
      handleConfidence: function(val) {
        this.updateIssueTypes(this.props.data.Issues, this.state.severity, val);
        this.setState({confidence: val});
      },
      handleIssueType: function(val) {
        this.setState({issueType: val});
      },
      updateIssues: function(data) {
        if (!data) {
          this.setState({data: data});
          return;
        }
        var allSeverities = data.Issues
          .map(function(issue) {
            return issue.severity
          })
          .sort()
          .filter(function(item, pos, ary) {
            return !pos || item != ary[pos - 1];
          });
        var allConfidences = data.Issues
          .map(function(issue) {
            return issue.confidence
          })
          .sort()
          .filter(function(item, pos, ary) {
            return !pos || item != ary[pos - 1];
          });
        var selectedSeverities = allSeverities;
        var selectedConfidences = allConfidences;
        this.updateIssueTypes(data.Issues, selectedSeverities, selectedConfidences);
        this.setState({
          data: data,
          severity: selectedSeverities,
          allSeverities: allSeverities,
          confidence: selectedConfidences,
          allConfidences: allConfidences,
          issueType: null
        });
      },
      updateIssueTypes: function(issues, severities, confidences) {
        var allTypes = issues
          .filter(function(issue) {
            return severities.includes(issue.severity);
          })
          .filter(function(issue) {
            return confidences.includes(issue.confidence);
          })
          .map(function(issue) {
            return issue.details;
          })
          .sort()
          .filter(function(item, pos, ary) {
            return !pos || item != ary[pos - 1];
          });
    
        if (this.state.issueType && !allTypes.includes(this.state.issueType)) {
          this.setState({issueType: null});
        }
        
        this.setState({allIssueTypes: allTypes});
      },
      render: function() {
        return (
          <div className="content">
            <div className="columns">
              <div className="column is-one-quarter">
                <Navigation
                  severity={ this.state.severity } 
                  confidence={ this.state.confidence }
                  issueType={ this.state.issueType }
                  allSeverities={ this.state.allSeverities } 
                  allConfidences={ this.state.allConfidences }
                  allIssueTypes={ this.state.allIssueTypes }
                  onSeverity={ this.handleSeverity } 
                  onConfidence={ this.handleConfidence } 
                  onIssueType={ this.handleIssueType }
                />
              </div>
              <div className="column is-three-quarters">
                <Issues
                  data={ this.props.data }
                  severity={ this.state.severity }
                  confidence={ this.state.confidence }
                  issueType={ this.state.issueType }
                />
              </div>
            </div>
          </div>
        );
      }
    });

    ReactDOM.render(
      <IssueBrowser data={ data } />,
      document.getElementById("content")
    );
  </script>
</body>
</html>